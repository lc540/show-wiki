# 02-配置监控和日志
```
 基于SpringBoot2.7.18，构建的示例项目，增加actuator监控
```
## 00相关说明
```
配置监控使用actuator组件
配置日志使用logback组件
```

## 01调整文件
- 编辑pom文件，`vim pom.xml`，增加内容：
```
<dependency>
   <groupId>org.springframework.boot</groupId>
   <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```


mvn-my package
java -jar target/boot-0.0.1.jar

在浏览器访问地址：http://localhost:8080/actuator 可查看开放的接口，默认只开放health接口

- 配置项启动或关闭
```
management:
 endpoints:
  web:
    exposure:
      # 配置*是开放所有，配置空字符串则是关闭所有
      include: '*'
```

## 02日志框架说明
springboot框架，starter-web模块已经默认集成logback日志框架  
在logback-spring.xml文件或者application.yml文件，直接配置即可  
简单的application.yml配置示例：
```
logging:
  file:
    name: boot.log
  level:
    root: info
```

- 日志框架历史
```
Log4j(1.x版本)时期
在2001年左右，由Ceki Gülcü开源，引入了几个核心概念，至今仍在被各大日志框架沿用
Logger (日志记录器) ：负责发起日志记录请求。Logger之间有层级关系，类似Java包名。
Appender (输出目的地) ：负责将日志输出到不同地方，比如控制台（ConsoleAppender）、文件（FileAppender、RollingFileAppender）、数据库（JDBCAppender）等。
Layout (日志格式化器) ：负责格式化日志信息，可以定义输出的时间、级别、线程名、类名、方法名、日志内容等。
Level (日志级别) ：常见的有 TRACE, DEBUG, INFO, WARN, ERROR, FATAL。可以设置Logger的级别，只输出大于等于该级别的日志。
Log4j 凭借其强大的功能和灵活性，迅速风靡一时。很多开源框架，如早期的Spring、Hibernate等都依赖它。
注意：Log4j 1.x 在 2015 年就停止维护了 (EOL)，而且有已知的安全漏洞！

混乱的过渡期：JCL 与 JUL
Apache考虑，如果每个组件都依赖特定的日志实现（比如都依赖Log4j），如果想更换日志该怎么办？
于是，JCL (Jakarta Commons Logging，后来也叫 Apache Commons Logging) 诞生了。
它的初衷是好的：提供一个日志门面 (Facade) 。
你的应用程序代码只需要依赖 JCL 的API，JCL 会在运行时动态查找并绑定到一个实际的日志实现（比如 Log4j 或 JDK自带的日志）。
JCL 的动态查找机制在复杂的类加载器环境下（比如各种应用服务器）经常出问题，导致著名的 “commons-logging hell” ，开发者总是为了解决依赖冲突而头疼。

JUL (Java Util Logging)
Sun公司在 Java 1.4 中引入了 java.util.logging (JUL)。
JUL 的好处是它是 JDK 自带的，不需要引入额外依赖。但它的API设计和配置相对 Log4j 来说比较拉跨，性能也一度被人诟病。
因此用的人也很少。

新一代门面：SLF4J (Simple Logging Facade for Java)
Log4j 的作者 Ceki Gülcü 大神看不下去了。
他认为 JCL 的设计存在缺陷，于是另起炉灶，在2006年左右创建了 SLF4J (Simple Logging Facade for Java) 。
SLF4J 的核心思想也是门面模式，但它采用了更清晰、更稳健的绑定机制：
你的代码只依赖 slf4j-api.jar
再加入一个“绑定包” ，桥接SLF4J到具体的日志实现。
SLF4J 通过在编译时就确定唯一的绑定，避免了JCL在运行时动态查找带来的类加载器问题。
同时 SLF4J 还提供了一些更方便的API，比如占位符语法：

Logback：Log4j 的精神继承者
Ceki Gülcü 在创建 SLF4J 之后，觉得 Log4j 1.x 的架构已经有些陈旧，难以适应新的需求。
于是，他着手开发了一个全新的日志实现，作为 Log4j 1.x 的“精神续作”—— Logback。

Log4j 2：Log4j 的进化
Log4j 1.x 社区也意识到了自身的问题和来自 Logback 的竞争压力。Apache 软件基金会组织力量，
对 Log4j 进行了彻底的重新设计和重写，推出了 Log4j 2。
Log4j 2 非常强大，尤其在追求极致性能和低延迟的场景下，它的异步日志器表现优异。

```


- 日志选择
```
Log4j 1.x：绝对不要用！ 有安全漏洞，已停止维护。

Logback：
通用首选。足够快，稳定，功能丰富。
Spring Boot 默认，社区成熟，资料多。
配置相对简单，上手快。

Log4j 2：
追求极致性能可选。特别是其异步日志器非常出色。
需要其低GC特性或高级插件。
配置稍复杂，但功能更强大。 
但是，由于实现复杂，经常出现比较严重的系统漏洞，需要及时关注和升级。
```